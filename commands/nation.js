exports.run = (client, message, args) => { // eslint-disable-line consistent-return
	const request = require("request");
	const { parseString } = require("xml2js");

	if (!args || args.length < 1) return message.channel.send("One or more arguments were missing");

	let target = args.join("_").toLowerCase();
	let targetURL = `https://www.nationstates.net/cgi-bin/api.cgi?nation=${target}&q=wa+region+lastactivity+category+fullname+flag`;

	request({
		url: targetURL,
		headers: { "User-Agent": "Quasar Discord Bot by Solborg" }
	}, (error, response, body) => { // eslint-disable-line consistent-return
		console.log(`Made request to: ${targetURL}`);
		console.log(`Error: ${error}`);
		console.log(`Status code: ${response}`);

		if (body.indexOf("Error") !== -1) return message.channel.send("There was an error with your request.");

		parseString(body, (err, result) => {
			console.log(`Parse error: ${err}`);

			let data = result.NATION;
			let embed = {
				color: 0x1772c9,
				title: data.FULLNAME[0],
				description: data.CATEGORY[0],
				url: `https://nationstates.net/nation=${target}`,
				thumbnail: { url: data.FLAG[0] },
				fields: [{
					name: "Region",
					value: data.REGION[0]
				},
				{
					name: "WA Status",
					value: data.UNSTATUS[0]
				},
				{
					name: "Active",
					value: data.LASTACTIVITY[0]
				}],
				footer: { text: "Generated by Quasar" }
			};
			message.channel.send({ embed });
		});
	});
};

exports.info = {
	name: "nation",
	desc: "returns an overview of the specified NS nation",
	syntax: "nation <NATION NAME>",
	args: true,
	argsLength: 1
};